<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Linux命令 | 812lcl的博客]]></title>
  <link href="http://812lcl.com/blog/categories/linuxming-ling/atom.xml" rel="self"/>
  <link href="http://812lcl.com/"/>
  <updated>2014-04-03T22:29:54+08:00</updated>
  <id>http://812lcl.com/</id>
  <author>
    <name><![CDATA[812lcl]]></name>
    <email><![CDATA[812liuchunlei@163.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Linux命令学习（1）：diff和patch]]></title>
    <link href="http://812lcl.com/blog/2014/04/03/linuxming-ling-xue-xi-%281%29%3Adiffhe-patch/"/>
    <updated>2014-04-03T21:03:00+08:00</updated>
    <id>http://812lcl.com/blog/2014/04/03/linuxming-ling-xue-xi-(1):diffhe-patch</id>
    <content type="html"><![CDATA[<p>diff 命令是 Linux 上非常重要的工具，用于比较文件甚至目录的内容，清晰的告诉你前后改动的地方。diff 可以输出为补丁(patch) ，Linux 中还有一条命令patch，可以根据补丁文件，对文件更新修改。当你和别人合作或想为开源项目提供贡献时，可以将自己的修改打成补丁，邮件给合作者，他即可合并你的代码。因此diff也是svn、cvs、git等版本控制工具不可或缺的一部分。</p>

<h1>diff</h1>

<p>diff的基本格式如下：</p>

<pre><code>$ diff [options] &lt;变动前的文件&gt; &lt;变动后的文件&gt;
</code></pre>

<p>diff有大概四种格式：<strong>正常格式</strong>、<strong>并列格式</strong>、<strong>上下文格式</strong>、<strong>合并格式</strong>。</p>

<!--more-->


<p>diff可以比较文件或目录之间的差异，首先来讲解文件之间的diff，示例文件如下：</p>

<p>文件f1</p>

<pre><code>a b
b
c
d
e
</code></pre>

<p>文件f2</p>

<pre><code>a b c
b
d
e
f
</code></pre>

<h2>正常格式diff</h2>

<p>正常格式不用加任何参数，<code>diff f1 f2</code>即可，显示结果如下：</p>

<pre><code>1c1
&lt; a b
---
&gt; a b c
3d2
&lt; c
5a5
&gt; f
</code></pre>

<p><code>1c1</code>、<code>3d2</code>、<code>5a5</code>是说明变动的位置，前边数字代表f1中变化的行，后边的则代表f2中变化的行，中间的字母分别代表“改变”（c）、“删除”（d）和“增加”（a）。</p>

<p><code>&lt;</code>表示f1指定行的内容，<code>---</code>分割两个文件的，然后<code>&gt;</code>表示f2指定行的内容。删除或增加时，则分别f2、f1中指定行无内容。</p>

<h2>并列格式diff</h2>

<p>其他格式diff都是先后显示两个文件的内容变化，并列格式可以并排显示两个文件的内容变化，更形象的看出文件的变化，和vimdiff显示的有些相似。</p>

<p>使用方法为加入<code>-y</code>参数，即可并列显示，<code>-W num</code>参数可设定并列的宽度，可以不使用。</p>

<pre><code>diff -y -W 50 f1 f2
</code></pre>

<p>结果如下：</p>

<pre><code>a b                   | a b c
b                       b
c                     &lt;
d                       d
e                       e
                      &gt; f
</code></pre>

<p><code>|</code>说明此行有变化，<code>&lt;</code>说明此行被删除了，<code>&gt;</code>说明此行是后增加的。</p>

<h2>上下文格式diff</h2>

<p>标准格式diff显示的内容不够直观，上下文格式则通过显示变化的上下文，而更加的利于理解。</p>

<p>使用方法为使用参数<code>-c</code>参数： <code>diff -c f1 f2</code>，结果如下：</p>

<pre><code>*** f1  2014-04-03 21:24:23.581007082 +0800
--- f2  2014-04-03 21:24:21.324995895 +0800
***************
*** 1,5 ****
! a b
  b
- c
  d
  e
--- 1,5 ----
! a b c
  b
  d
  e
+ f
</code></pre>

<p>首先，显示两个文件的基本情况：</p>

<pre><code>*** f1  2014-04-03 21:24:23.581007082 +0800
--- f2  2014-04-03 21:24:21.324995895 +0800
</code></pre>

<p><code>***</code>表示变动前的文件f1，<code>---</code>表示变动后的文件f2。</p>

<p>然后，15个星号将文件的基本情况与变动内容分割开。</p>

<p>最后，显示f1和f2文件的内容变动情况。</p>

<p><code>*** 1,5 ****</code>表示f1文件的1~5行</p>

<p><code>--- 1,5 ----</code>表示f2文件的1~5行</p>

<p><code>!</code>代表次行内容有变动，<code>+</code>表示此行为新增加，<code>-</code>表示此行被删除了。</p>

<p>上下文格式默认显示包括修改行前后的三行内容，可以使用<code>-num</code>来设置显示前后num行，如：</p>

<pre><code>diff -c -1 f1 f2
</code></pre>

<h2>合并格式diff</h2>

<p>两个文件大量内容重复，上下文格式将显示很多无用干扰信息，后来就退出了合并式diff。</p>

<p>使用方法为，加入<code>-u</code>参数，<code>diff -u f1 f2</code>，结果如下：</p>

<pre><code>--- f1  2014-04-03 21:24:23.581007082 +0800
+++ f2  2014-04-03 21:24:21.324995895 +0800
@@ -1,5 +1,5 @@
-a b
+a b c
 b
-c
 d
 e
+f
</code></pre>

<p>同样前两行表示两个文件的基本情况</p>

<p>然后<code>@@ -1,5 +1,5 @@</code>表示修改的位置，<code>-</code>代表 f1 的1~5行，<code>+</code>代表 f2 的1~5行。</p>

<p>最后是合并显示的变动具体内容，依旧是<code>-</code>代表f1，<code>+</code>代表f2。</p>

<p>同上下文格式一样，合并格式也是默认显示修改前后3行的内容，也可以使用<code>-num</code>来设置显示前后num行：</p>

<pre><code>diff -u -1 f1 f2
</code></pre>

<p>这里还要提到，git使用的是合并格式diff的变体。当前工作目录下<code>git add f1</code>后，修改f1的内容，可以使用如下命令，观察做出的修改</p>

<pre><code>git diff
</code></pre>

<p>结果如下：</p>

<pre><code>diff --git a/f1 b/f1
index 924a897..c3b09ff 100644
--- a/f1
+++ b/f1
@@ -1,5 +1,5 @@
-a b
+a b c
 b
-c
 d
 e
+f
</code></pre>

<p>和合并格式diff的区别在头部文件基本信息，<code>git diff</code>显示的是a、b两个版本的f1文件的内容变化，并且显示了两个版本的git哈希值（924a897..c3b09ff），与文件的权限（644）。</p>
]]></content>
  </entry>
  
</feed>
